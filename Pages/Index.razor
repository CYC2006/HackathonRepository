@page "/"

<h1 style="text-align:center;">ğŸŒ æ°¸çºŒå¤§å¯Œç¿</h1>

<div style="display:flex; justify-content:space-around; margin-bottom:20px;">
    <div>ğŸ’° é‡‘éŒ¢ï¼š@money</div>
    <div>ğŸŒ¿ ç’°ä¿è©•åˆ†ï¼š@ecoScore</div>
    <div>ğŸ›ï¸ ç¤¾æœƒè§€æ„Ÿï¼š@socialScore</div>
    <div>ğŸ“… ç¬¬ @week é€±</div>
</div>

<div style="display:grid; grid-template-columns: repeat(6, 100px); gap:5px; justify-content:center; margin:auto;">
    @foreach (var tile in mapTiles)
    {
        <div class="tile @(playerPosition == tile.Id ? "player-tile" : "")" 
             @ondblclick="@(() => ShowCityInfo(tile))">
            @tile.Name
        </div>
    }
</div>

<div style="text-align:center; margin-top:30px;">
    <button class="btn btn-primary" @onclick="RollDice">ğŸ² æ“²éª°å­</button>
    <p>ä½ æ“²åˆ°äº†ï¼š@lastRoll</p>
</div>

@if (showDialog)
{
    <div class="overlay">
        <div class="dialog">
            <h3>@dialogTitle</h3>
            <p>@dialogMessage</p>
            <button @onclick="ConfirmEvent">ç¢ºå®š</button>
            <button @onclick="CancelEvent">å–æ¶ˆ</button>
        </div>
    </div>
}

@code {
    // === ç‹€æ…‹è®Šæ•¸ ===
    int money = 0;
    int ecoScore = 0;
    int socialScore = 0;
    int week = 1;
    int playerPosition = 0;
    int lastRoll = 0;

    bool showDialog = false;
    string dialogTitle = "";
    string dialogMessage = "";

    record Tile(int Id, string Name, string Type);
    List<Tile> mapTiles = new()
    {
        new(0, "å°å—", "City"),
        new(1, "é«˜é›„", "City"),
        new(2, "å±æ±", "City"),
        new(3, "æ©Ÿæœƒ", "Chance"),
        new(4, "å‘½é‹", "Fate"),
        new(5, "å˜‰ç¾©", "City"),
        new(6, "é›²æ—", "City"),
        new(7, "å½°åŒ–", "City"),
        new(8, "å°ä¸­", "City"),
        new(9, "è‹—æ —", "City"),
        new(10, "æ–°ç«¹", "City"),
        new(11, "æ¡ƒåœ’", "City"),
        new(12, "æ–°åŒ—", "City"),
        new(13, "å°åŒ—", "City"),
        new(14, "å®œè˜­", "City"),
        new(15, "èŠ±è“®", "City"),
        new(16, "å°æ±", "City"),
    };

    void RollDice()
    {
        var rand = new Random();
        lastRoll = rand.Next(1, 7);
        playerPosition = (playerPosition + lastRoll) % mapTiles.Count;
        week++;

        var tile = mapTiles[playerPosition];
        if (tile.Type == "City" || tile.Type == "Chance" || tile.Type == "Fate")
        {
            dialogTitle = $"æŠµé”ï¼š{tile.Name}";
            dialogMessage = $"æ˜¯å¦è¦æŸ¥çœ‹ {tile.Type} äº‹ä»¶ï¼Ÿ";
            showDialog = true;
        }
    }

    void ShowCityInfo(Tile tile)
    {
        dialogTitle = $"{tile.Name} è³‡æ–™";
        dialogMessage = $"é€™è£¡å°‡é¡¯ç¤º {tile.Name} çš„æ°¸çºŒç™¼å±•è³‡æ–™...";
        showDialog = true;
    }

    void ConfirmEvent() => showDialog = false;
    void CancelEvent() => showDialog = false;
}