@page "/cards"
@using Hackathon.Data
@inject Hackathon.Data.GameState Game

<h2 style="text-align:center; font-size:2.2rem; margin-top:30px; margin-bottom:30px;">
    🎴 Collected Cards 🎴
</h2>


<h2 id="region" style="text-align:left;">🃏 Regional Cards</h2>
@if (Game.CollectedCards.Count == 0)
{
    <h4 style="text-align:center; margin-top:20px;">----- No Card Collected -----</h4>
}
else
{
    <div class="card-gallery">
        @foreach (var card in Game.CollectedCards)
        {
            <div class="card-item rarity-bg-@card.Rarity">
                <div class="card-title">@card.Title</div>
                <div class="card-meta">
                    <span class="card-city">@card.City</span>
                    <span class="card-rarity rarity-@card.Rarity">@card.Rarity</span>
                </div>
                @if (!string.IsNullOrEmpty(card.ImagePath))
                {
                    <img src="@card.ImagePath" alt="@card.Title" class="card-image" />
                }
                else
                {
                    <div class="card-image"></div>
                }
                <div class="card-stats">
                    <div>💰 @card.MoneyChange 🌿 @card.EcoChange 🏛️ @card.SocialChange</div>
                </div>
                <div class="card-desc">@card.Description</div>
            </div>
        }
    </div>
}


<h2 id="event" style="text-align:left;">🃏 Event Cards</h2>
<h2 id="other" style="text-align:left;">🃏 Other Cards</h2>


@code {
    protected override void OnInitialized()
    {
        // 若有舊卡沒有 City，就自動補上
        foreach (var card in Game.CollectedCards)
        {
            if (string.IsNullOrEmpty(card.City))
                card.City = GetCityName(card);
        }
    }

    string GetCityName(CardInfo card)
    {
        if (card.ImagePath?.Contains("tainan", StringComparison.OrdinalIgnoreCase) == true) return "台南";
        if (card.ImagePath?.Contains("taipei", StringComparison.OrdinalIgnoreCase) == true) return "台北";
        if (card.ImagePath?.Contains("kaohsiung", StringComparison.OrdinalIgnoreCase) == true) return "高雄";
        return "其他";
    }
}