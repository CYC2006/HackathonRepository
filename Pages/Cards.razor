@page "/cards"
@using Hackathon.Data
@inject Hackathon.Data.GameState Game

<h2 style="text-align:center; font-size:2.2rem; margin-top:30px; margin-bottom:30px;">
    üé¥ Collected Cards üé¥
</h2>


<h2 id="region" style="text-align:left;">üÉè Regional Cards</h2>
@if (Game.CollectedCards.Count == 0)
{
    <h4 style="text-align:center; margin-top:20px;">----- No Card Collected -----</h4>
}
else
{
    <div class="card-gallery">
        @foreach (var card in Game.CollectedCards)
        {
            <div class="card-item rarity-bg-@card.Rarity">
                <div class="card-title">@card.Title</div>
                <div class="card-meta">
                    <span class="card-city">@card.City</span>
                    <span class="card-rarity rarity-@card.Rarity">@card.Rarity</span>
                </div>
                @if (!string.IsNullOrEmpty(card.ImagePath))
                {
                    <img src="@card.ImagePath" alt="@card.Title" class="card-image" />
                }
                else
                {
                    <div class="card-image"></div>
                }
                <div class="card-stats">
                    <span>
                        <img src="/images/icons/Money.png" alt="Money" width="20" height="20" />
                        @card.MoneyChange
                    </span>
                    <span>
                        <img src="/images/icons/EcoScore.png" alt="Eco" width="20" height="20" />
                        @card.EcoChange
                    </span>
                    <span>
                        <img src="/images/icons/SocialScore.png" alt="Social" width="20" height="20" />
                        @card.SocialChange
                    </span>
                </div>
                <div class="card-desc">@card.Description</div>
            </div>
        }
    </div>
}


<h2 id="sustain" style="text-align:left;">üÉè Sustain Cards</h2>
@if (Game.OngoingEffects.Count == 0)
{
    <h4 style="text-align:center; margin-top:20px;">----- No Ongoing Cards -----</h4>
}
else
{
    <div class="card-gallery">
        @foreach (var e in Game.OngoingEffects)
        {
            CardInfo? baseCard = null;

            // search for all card data
            foreach (var city in CardDESC.Title.Keys)
            {
                var found = CardData.GetCardsForCity(city)
                                    .FirstOrDefault(c => c.Title == e.Title);
                if (found is not null)
                {
                    baseCard = found;
                    break;
                }
            }

            if (baseCard is not null)
            {
                <div class="card-item rarity-bg-@baseCard.Rarity">
                    <div class="card-title">@baseCard.Title</div>
                    <div class="card-meta">
                        <span class="card-city">@baseCard.City</span>
                        <span class="card-rarity rarity-@baseCard.Rarity">@baseCard.Rarity</span>
                    </div>

                    @if (!string.IsNullOrEmpty(baseCard.ImagePath))
                    {
                        <img src="@baseCard.ImagePath" alt="@baseCard.Title" class="card-image" />
                    }
                    else
                    {
                        <div class="card-image"></div>
                    }

                    <div class="card-stats sustain-stats">
                        <div style="display:flex; align-items:center; gap:6px;">
                            @switch (e.TargetVar)
                            {
                                case "Money":
                                    <img src="/images/icons/Money.png" alt="Money" width="20" height="20" />
                                    break;
                                case "EcoScore":
                                    <img src="/images/icons/EcoScore.png" alt="Eco" width="20" height="20" />
                                    break;
                                case "SocialScore":
                                    <img src="/images/icons/SocialScore.png" alt="Social" width="20" height="20" />
                                    break;
                            }
                            <text>@e.MinChange ~ @e.MaxChange</text>
                        </div>

                        <div style="display:flex; align-items:center; gap:4px;">
                            <img src="/images/icons/Hourglass.png" alt="Duration" width="16" height="16" />
                            @if (e.Duration == -1) { <text>Ever</text> }
                            else { <text>@e.Duration</text> }
                        </div>
                    </div>
                    <div class="card-desc">@baseCard.Description</div>
                </div>
            }
        }
    </div>
}


<h2 id="other" style="text-align:left;">üÉè Event Cards</h2>

@if (Game.TriggeredEvents.Count == 0)
{
    <h4 style="text-align:center; margin-top:20px;">----- No Events Triggered -----</h4>
}
else
{
    <div class="card-gallery">
        @foreach (var e in Game.TriggeredEvents)
        {
            <div class="event-card">
                <div class="event-card-type">„Äê@e.Type„Äë@e.Title</div>
                    @if (!string.IsNullOrEmpty(e.ImagePath))
                    {
                        <img src="@e.ImagePath" alt="@e.Type" class="event-card-image" />
                    }

                    <div class="event-card-stats">
                        <span>
                            <img src="/images/icons/Money.png" width="18" /> @e.MoneyChange
                        </span>
                        <span>
                            <img src="/images/icons/EcoScore.png" width="18" /> @e.EcoChange
                        </span>
                        <span>
                            <img src="/images/icons/SocialScore.png" width="18" /> @e.SocialChange
                        </span>
                    </div>
                <div class="event-card-desc">@e.Description</div>
            </div>
        }
    </div>
}