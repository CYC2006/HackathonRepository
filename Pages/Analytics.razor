@page "/analytics"
@using Hackathon.Data
@inject GameState Game

<h2 style="text-align:center; margin:20px 0;">üìä Game Progress</h2>

<!-- Chart -->
@if (Game.History.Count > 0)
{
    <div class="chart-wrap">
        <svg width="1000" height="600" style="background:#e5e5e5; border-radius:12px;">

            <!-- Get Range and Scale -->
            @{
                const double baseY = 400;
                const double moneyScale = 1.0 / 20.0;
                const double ecoScale = 2.0;
                const double socialScale = 2.0;
            }

            <!-- Bottom Line -->
            <line x1="0" y1="@baseY" x2="1000" y2="@baseY" stroke="#444" stroke-width="2" />

            <!-- Money Line -->
            @{
                var moneyPoints = new List<string>();
                for (int i = 0; i < Game.History.Count; i++)
                {
                    double x = 50 + i * 20;
                    double y = baseY - (Game.History[i].Money - 1000) * moneyScale;
                    moneyPoints.Add($"{x},{y}");
                }
                string moneyLinePoints = string.Join(" ", moneyPoints);
            }
            <polyline points="@moneyLinePoints" fill="none" stroke="#FFD700" stroke-width="3" />

            <!-- Eco Line -->
            @{
                var ecoPoints = new List<string>();
                for (int i = 0; i < Game.History.Count; i++)
                {
                    double x = 50 + i * 20; // ÊØèÈÄ±ÂæÄÂè≥ 20pxÔºåÂ∑¶ÈÇäÁïô 50px margin
                    double y = baseY - (Game.History[i].EcoScore) * ecoScale;
                    ecoPoints.Add($"{x},{y}");
                }
                string ecoLinePoints = string.Join(" ", ecoPoints);
            }
            <polyline points="@ecoLinePoints" fill="none" stroke="#00C853" stroke-width="3" />

            <!-- Social Line -->
            @{
                var socialPoints = new List<string>();
                for (int i = 0; i < Game.History.Count; i++)
                {
                    double x = 50 + i * 20; // ÊØèÈÄ±ÂæÄÂè≥ 20pxÔºåÂ∑¶ÈÇäÁïô 50px margin
                    double y = baseY - (Game.History[i].SocialScore) * socialScale;
                    socialPoints.Add($"{x},{y}");
                }
                string socialLinePoints = string.Join(" ", socialPoints);
            }
            <polyline points="@socialLinePoints" fill="none" stroke="#2979FF" stroke-width="3" />

            <!-- Money Dot -->
            @for (int i = 0; i < Game.History.Count; i++)
            {
                double x = 50 + i * 20;
                double y = baseY - (Game.History[i].Money - 1000) * moneyScale;
                var val = Game.History[i].Money;

                <g class="data-point" style="pointer-events: all;">
                    <circle cx="@x" cy="@y" r="6" fill="#EFD110" />
                    <text x="@x" y="@(y - 14)" class="data-label">@val</text>
                </g>
            }

            <!-- Eco Dot -->
            @for (int i = 0; i < Game.History.Count; i++)
            {
                double x = 50 + i * 20;
                double y = baseY - (Game.History[i].EcoScore) * ecoScale;
                var val = Game.History[i].EcoScore;

                <g class="data-point" style="pointer-events: all;">
                    <circle cx="@x" cy="@y" r="6" fill="#009624" />
                    <text x="@x" y="@(y - 14)" class="data-label">@val</text>
                </g>
            }

            <!-- Social Dot -->
            @for (int i = 0; i < Game.History.Count; i++)
            {
                double x = 50 + i * 20;
                double y = baseY - (Game.History[i].SocialScore) * socialScale;
                var val = Game.History[i].SocialScore;

                <g class="data-point" style="pointer-events: all;">
                    <circle cx="@x" cy="@y" r="6" fill="#0D47A1" />
                    <text x="@x" y="@(y - 14)" class="data-label">@val</text>
                </g>
            }

            <!-- Keys -->
            <g transform="translate(720,550)">
                <rect width="16" height="16" fill="#EFD110" />
                <text x="20" y="14" font-size="14px">Money</text>
                <rect x="100" width="16" height="16" fill="#00C853" />
                <text x="120" y="14" font-size="14px">Eco</text>
                <rect x="180" width="16" height="16" fill="#2979FF" />
                <text x="200" y="14" font-size="14px">Social</text>
            </g>
        </svg>
    </div>
}

<!-- Table -->
<div class="table-container">
    @if (Game.History.Count == 0)
    {
        <p>No record yet.</p>
    }
    else
    {
        <table class="record-table">
            <thead>
                <tr>
                    <th>Week</th>
                    <th>Money üí∞</th>
                    <th>Eco üåø</th>
                    <th>Social ü§ù</th>
                </tr>
            </thead>
            <tbody>
                @for (int i = 0; i < Game.History.Count; i++)
                {
                    var rec = Game.History[i];
                    <tr>
                        <td>@i</td>
                        <td>@rec.Money</td>
                        <td>@rec.EcoScore</td>
                        <td>@rec.SocialScore</td>
                    </tr>
                }
            </tbody>
        </table>
    }
</div>